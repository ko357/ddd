<!DOCTYPE html>
<html>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ø±ÙˆØ­ÙŠ â€“ ØªØ³Ø¨ÙŠØ­ ÙˆØ°ÙƒØ± Ø¨Ø·Ù…Ø£Ù†ÙŠÙ†Ø©</title>

  <style>
    :root {
            --bg-light: #F0F7F4;
            --text-light: #0D1B2A;
            --primary-light: #3D5A80;
            --accent-light: #B49A67;
            
            --bg-dark: #0D1B2A;
            --text-dark: #E0E1DD;
            --primary-dark: #98C1D9;
            --accent-dark: #E0E1DD;
        }
        html.dark {
            --bg-light: var(--bg-dark);
            --text-light: var(--text-dark);
            --primary-light: var(--primary-dark);
            --accent-light: var(--accent-dark);
        }
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-light);
            transition: background-color 0.5s, color 0.5s;
        }
        .bg-primary { background-color: var(--primary-light); }
        .text-accent { color: var(--accent-light); }
        .border-accent { border-color: var(--accent-light); }
        .ring-accent { --tw-ring-color: var(--accent-light); }
        .tab-active {
            background-color: var(--primary-light);
            color: var(--bg-light);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
  </style>

  
</head>
<body>
  <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Soothing Teal and Gold -->
    <!-- Application Structure Plan: The application is structured as a two-tab single-page application (SPA), separating the 'Tasbeeh' (interactive tool) from the 'Dhikr' (reference library) sections. This structure was chosen for its clarity and intuitive user flow, directly reflecting the source report's logic. Users land on the primary tool (Tasbeeh), with the content-rich Dhikr section accessible via a single click, preventing initial overload. Key interactions include tab switching, dropdowns for Tasbeeh selection, and modals for goals and Dhikr details, all designed for optimal usability. -->
    <!-- Visualization & Content Choices: 
        - Tasbeeh Counter (Goal: Inform & Track): A large button with a dynamic progress ring on a Canvas provides immediate, motivating feedback. Interaction is via click or voice. Library: Vanilla JS + Canvas API.
        - Dhikr Library (Goal: Organize & Inform): An HTML/CSS accordion organizes categories, with clickable cards opening modals for focused reading of each Dhikr's details. Library: Vanilla JS.
        - Audio Playback Simulation (Goal: Enhance Experience): A play icon in the Dhikr modal triggers a simple sound, demonstrating the feature without external files. Library: Tone.js.
        - Voice Recognition (Goal: Enhance Accessibility): A toggle button activates the Web Speech API to fulfill a key 'AI' feature from the report. Library: Web Speech API.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    



    <div class="container mx-auto max-w-2xl p-4 min-h-screen flex flex-col">

        <!-- Header -->
        <header class="text-center py-4">
            <h1 class="text-4xl font-bold text-accent">Ø±ÙˆØ­ÙŠ</h1>
            <p class="text-lg opacity-80">ØªØ³Ø¨ÙŠØ­ ÙˆØ°ÙƒØ± Ø¨Ø·Ù…Ø£Ù†ÙŠÙ†Ø©</p>
        </header>

        <!-- Dark Mode Toggle -->
        <div class="absolute top-4 left-4">
            <button id="darkModeToggle" class="p-2 rounded-full focus:outline-none focus:ring-2 ring-accent">
                <span class="dark:hidden">ğŸŒ™</span>
                <span class="hidden dark:inline">â˜€ï¸</span>
            </button>
        </div>

        <!-- Navigation Tabs -->
        <nav class="flex justify-center my-6 bg-gray-200 dark:bg-gray-800 rounded-full p-1 shadow-inner">
            <button data-view="tasbeeh" class="view-tab tab-active w-1/2 py-2 px-4 rounded-full text-lg font-bold transition-colors duration-300">Ø§Ù„ØªØ³Ø¨ÙŠØ­</button>
            <button data-view="dhikr" class="view-tab w-1/2 py-2 px-4 rounded-full text-lg font-bold transition-colors duration-300">Ø§Ù„Ø£Ø°ÙƒØ§Ø±</button>
        </nav>

        <!-- Main Content -->
        <main class="flex-grow">
            <!-- Tasbeeh View -->
            <div id="view-tasbeeh" class="view-content space-y-8">
                <div class="text-center">
                  <p class="text-lg">Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ù…Ø®ØµØµ Ù„Ù„ØªØ³Ø¨ÙŠØ­ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ³Ø¨ÙŠØ­ØŒ ØªØ­Ø¯ÙŠØ¯ Ù‡Ø¯ÙØŒ ÙˆØ§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„Ø°ÙƒØ±. Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù„Ù„ØªØ³Ø¨ÙŠØ­ Ø¨ØµÙˆØªÙƒ.</p>
                </div>
                <!-- Tasbeeh Selector -->
                <div class="flex flex-col items-center">
                    <label for="tasbeeh-select" class="text-lg mb-2">Ø§Ø®ØªØ± Ø§Ù„ØªØ³Ø¨ÙŠØ­:</label>
                    <select id="tasbeeh-select" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 border-2 border-transparent focus:border-accent focus:ring-0">
                        <option value="Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡</option>
                        <option value="Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡">Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡</option>
                        <option value="Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±">Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±</option>
                        <option value="Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡">Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡</option>
                    </select>
                </div>
                
                <!-- Tasbeeh Counter -->
                <div class="relative flex justify-center items-center w-64 h-64 mx-auto">
                    <canvas id="progress-canvas" width="256" height="256" class="absolute inset-0"></canvas>
                    <button id="tasbeeh-counter-btn" class="w-48 h-48 rounded-full bg-primary text-white flex flex-col justify-center items-center shadow-lg transform active:scale-95 transition-transform duration-150">
                        <span id="tasbeeh-counter-text" class="text-5xl font-bold">0</span>
                        <span class="opacity-80">Ø§Ø¶ØºØ· Ù‡Ù†Ø§</span>
                    </button>
                </div>

                <!-- Goal and Controls -->
                <div class="text-center space-y-4">
                    <p class="text-xl">Ø§Ù„Ù‡Ø¯Ù: <span id="goal-display">100</span></p>
                    <div class="flex justify-center items-center space-x-4">
                        <button id="set-goal-btn" class="py-2 px-6 rounded-full bg-gray-300 dark:bg-gray-700 font-semibold transition-colors hover:bg-opacity-80">ØªØºÙŠÙŠØ± Ø§Ù„Ù‡Ø¯Ù</button>
                         <button id="voice-control-btn" class="p-4 rounded-full bg-gray-300 dark:bg-gray-700 font-semibold transition-colors hover:bg-opacity-80">
                            ğŸ¤
                        </button>
                        <button id="reset-btn" class="py-2 px-6 rounded-full bg-red-400 dark:bg-red-600 text-white font-semibold transition-colors hover:bg-opacity-80">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                    </div>
                    <p id="voice-status" class="text-sm h-5 transition-opacity duration-300 opacity-0"></p>
                </div>
            </div>

            <!-- Dhikr View -->
            <div id="view-dhikr" class="view-content hidden space-y-4">
                <div class="text-center">
                  <p class="text-lg">Ù‡Ù†Ø§ ØªØ¬Ø¯ Ù…ÙƒØªØ¨Ø© Ø´Ø§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ù…Ù†Ø¸Ù…Ø© Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø§Øª. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ ÙØ¦Ø© Ù„Ø¹Ø±Ø¶ Ø£Ø°ÙƒØ§Ø±Ù‡Ø§ØŒ Ø«Ù… Ø§Ø®ØªØ± Ø°ÙƒØ±Ù‹Ø§ Ù„Ù‚Ø±Ø§Ø¡ØªÙ‡ ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¥Ù„ÙŠÙ‡.</p>
                </div>
                <div id="dhikr-accordion" class="space-y-2">
                    <!-- Accordion items will be injected here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Set Goal Modal -->
    <div id="goal-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white dark:bg-gray-800 w-full max-w-sm rounded-lg shadow-xl p-6 space-y-4">
            <h3 class="text-2xl font-bold text-center">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
            <input id="goal-input" type="number" class="w-full p-3 text-center rounded-lg bg-gray-200 dark:bg-gray-700 border-2 border-transparent focus:border-accent focus:ring-0" placeholder="100">
            <div class="flex justify-end space-x-3">
                <button id="cancel-goal-btn" class="py-2 px-5 rounded-full bg-gray-300 dark:bg-gray-700">Ø¥Ù„ØºØ§Ø¡</button>
                <button id="save-goal-btn" class="py-2 px-5 rounded-full bg-primary text-white">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Dhikr Details Modal -->
    <div id="dhikr-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white dark:bg-gray-800 w-full max-w-lg max-h-[90vh] rounded-lg shadow-xl p-6 flex flex-col">
            <div id="dhikr-modal-content" class="space-y-4 overflow-y-auto pr-2">
                <!-- Content will be injected here -->
            </div>
            <button id="close-dhikr-modal-btn" class="mt-6 py-2 px-5 rounded-full bg-primary text-white w-full">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
            // STATE
            let state = {
                currentView: 'tasbeeh',
                tasbeehCount: 0,
                tasbeehGoal: 100,
                isDarkMode: false,
                isListening: false,
            };

            // ELEMENTS
            const elements = {
                body: document.body,
                darkModeToggle: document.getElementById('darkModeToggle'),
                viewTabs: document.querySelectorAll('.view-tab'),
                viewContents: document.querySelectorAll('.view-content'),
                tasbeehBtn: document.getElementById('tasbeeh-counter-btn'),
                tasbeehText: document.getElementById('tasbeeh-counter-text'),
                goalDisplay: document.getElementById('goal-display'),
                setGoalBtn: document.getElementById('set-goal-btn'),
                resetBtn: document.getElementById('reset-btn'),
                goalModal: document.getElementById('goal-modal'),
                goalInput: document.getElementById('goal-input'),
                saveGoalBtn: document.getElementById('save-goal-btn'),
                cancelGoalBtn: document.getElementById('cancel-goal-btn'),
                dhikrAccordion: document.getElementById('dhikr-accordion'),
                dhikrModal: document.getElementById('dhikr-modal'),
                dhikrModalContent: document.getElementById('dhikr-modal-content'),
                closeDhikrModalBtn: document.getElementById('close-dhikr-modal-btn'),
                progressCanvas: document.getElementById('progress-canvas'),
                tasbeehSelect: document.getElementById('tasbeeh-select'),
                voiceControlBtn: document.getElementById('voice-control-btn'),
                voiceStatus: document.getElementById('voice-status'),
            };

            const ctx = elements.progressCanvas.getContext('2d');
            
            let synth;
            let milestoneSynth;

            // Initialize Tone.js synths only if Tone is defined
            if (typeof Tone !== 'undefined') {
                synth = new Tone.Synth().toDestination();
                milestoneSynth = new Tone.FMSynth().toDestination();
            } else {
                console.warn("Tone.js not loaded. Audio features will be disabled.");
                // Provide dummy functions to prevent errors if Tone is not defined
                synth = { triggerAttackRelease: () => {} };
                milestoneSynth = { triggerAttackRelease: () => {} };
            }

            // DHIKR DATA
            const dhikrData = {
                "Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­": [
                    { text: "Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ ÙˆÙØ£ÙØµÙ’Ø¨ÙØ­Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„Ù‘ÙÙ‡ÙØŒ ÙˆÙØ§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„Ù‘ÙÙ‡ÙØŒ Ù„Ø§Ù Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ø§Ù‘Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„Ø§Ù Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡ÙØŒ Ù„ÙÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙÙ‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„Ù‘Ù Ø´ÙÙŠÙ’Ø¡Ù Ù‚ÙØ¯ÙÙŠØ±ÙŒ...", count: 1, fadl: "Ù…Ù† Ù‚Ø§Ù„Ù‡Ø§ Ù…ÙˆÙ‚Ù†Ù‹Ø§ Ø¨Ù‡Ø§ Ø­ÙŠÙ† ÙŠÙ…Ø³ÙŠØŒ ÙÙ…Ø§Øª Ù…Ù† Ù„ÙŠÙ„ØªÙ‡ Ø¯Ø®Ù„ Ø§Ù„Ø¬Ù†Ø©ØŒ ÙˆÙƒØ°Ù„Ùƒ Ø¥Ø°Ø§ Ø£ØµØ¨Ø­." },
                    { text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø¨ÙÙƒÙ Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙØ­Ù’ÙŠÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙÙ…ÙÙˆØªÙØŒ ÙˆÙØ¥ÙÙ„ÙÙŠÙ’ÙƒÙ Ø§Ù„Ù†Ù‘ÙØ´ÙÙˆØ±Ù.", count: 1, fadl: "Ù…Ù† Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­ Ø§Ù„Ù…Ø£Ø«ÙˆØ±Ø©." },
                    { text: "Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙØ¨ÙØ­ÙÙ…Ù’Ø¯ÙÙ‡ÙØŒ Ø¹ÙØ¯ÙØ¯Ù Ø®ÙÙ„Ù’Ù‚ÙÙ‡ÙØŒ ÙˆÙØ±ÙØ¶ÙØ§ Ù†ÙÙÙ’Ø³ÙÙ‡ÙØŒ ÙˆÙØ²ÙÙ†ÙØ©Ù Ø¹ÙØ±Ù’Ø´ÙÙ‡ÙØŒ ÙˆÙÙ…ÙØ¯ÙØ§Ø¯Ù ÙƒÙÙ„ÙÙ…ÙØ§ØªÙÙ‡Ù.", count: 3, fadl: "ØªØ¹Ø¯Ù„ Ø³Ø§Ø¹Ø§Øª Ù…Ù† Ø§Ù„Ø°ÙƒØ±." }
                ],
                "Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡": [
                    { text: "Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ ÙˆÙØ£ÙÙ…Ù’Ø³ÙÙ‰ Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„Ù‘ÙÙ‡ÙØŒ ÙˆÙØ§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„Ù‘ÙÙ‡ÙØŒ Ù„Ø§Ù Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ø§Ù‘Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„Ø§Ù Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡ÙØŒ Ù„ÙÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙÙ‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„Ù‘Ù Ø´ÙÙŠÙ’Ø¡Ù Ù‚ÙØ¯ÙÙŠØ±ÙŒ...", count: 1, fadl: "Ù…Ù† Ù‚Ø§Ù„Ù‡Ø§ Ù…ÙˆÙ‚Ù†Ù‹Ø§ Ø¨Ù‡Ø§ Ø­ÙŠÙ† ÙŠÙ…Ø³ÙŠØŒ ÙÙ…Ø§Øª Ù…Ù† Ù„ÙŠÙ„ØªÙ‡ Ø¯Ø®Ù„ Ø§Ù„Ø¬Ù†Ø©." },
                     { text: "Ø£Ø¹ÙˆØ°Ù Ø¨ÙƒÙ„Ù…Ø§ØªÙ Ø§Ù„Ù„Ù‡Ù Ø§Ù„ØªØ§Ù…Ø§Ø©Ù Ù…ÙÙ† Ø´Ø±ÙÙ‘ Ù…Ø§ Ø®Ù„ÙÙ‚.", count: 3, fadl: "Ù…Ù† Ù‚Ø§Ù„Ù‡Ø§ Ø­ÙŠÙ† ÙŠÙ…Ø³ÙŠ Ø«Ù„Ø§Ø« Ù…Ø±Ø§Øª Ù„Ù… ØªØ¶Ø±Ù‡ Ø­Ù…Ø© ØªÙ„Ùƒ Ø§Ù„Ù„ÙŠÙ„Ø©." },
                ],
                "Ø£Ø°ÙƒØ§Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØµÙ„Ø§Ø©": [
                    { text: "Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù (Ø«ÙÙ„Ø§Ø«Ø§Ù‹) Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø£ÙÙ†Ù’ØªÙ Ø§Ù„Ø³Ù‘ÙÙ„Ø§ÙÙ…ÙØŒ ÙˆÙÙ…ÙÙ†Ù’ÙƒÙ Ø§Ù„Ø³Ù‘ÙÙ„ÙØ§Ù…ÙØŒ ØªÙØ¨ÙØ§Ø±ÙÙƒÙ’ØªÙ ÙŠÙØ§ Ø°ÙØ§ Ø§Ù„Ù’Ø¬ÙÙ„Ø§ÙÙ„Ù ÙˆÙØ§Ù„Ù’Ø¥ÙÙƒÙ’Ø±ÙØ§Ù…Ù.", count: 1, fadl: "Ù…Ù† Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø£Ø«ÙˆØ±Ø© Ø¯Ø¨Ø± ÙƒÙ„ ØµÙ„Ø§Ø©." },
                    { text: "Ù„Ø§Ù Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ø§Ù‘Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„Ø§Ù Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡ÙØŒ Ù„ÙÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙØŒ ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯ÙØŒ ÙˆÙÙ‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„Ù‘Ù Ø´ÙÙŠÙ’Ø¡Ù Ù‚ÙØ¯ÙÙŠØ±ÙŒ...", count: 1, fadl: "Ù…Ù† Ù‚Ø§Ù„Ù‡Ø§ ÙÙŠ Ø¯Ø¨Ø± ÙƒÙ„ ØµÙ„Ø§Ø© Ù…ÙƒØªÙˆØ¨Ø© Ù„Ù… ÙŠÙ…Ù†Ø¹Ù‡ Ù…Ù† Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¬Ù†Ø© Ø¥Ù„Ø§ Ø£Ù† ÙŠÙ…ÙˆØª." },
                ],
                 "Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†ÙˆÙ…": [
                    { text: "Ø¨ÙØ§Ø³Ù’Ù…ÙÙƒÙ Ø±ÙØ¨ÙÙ‘Ù€ÙŠ ÙˆÙØ¶ÙØ¹Ù’Ù€ØªÙ Ø¬ÙÙ†Ù’Ù€Ø¨ÙŠØŒ ÙˆÙØ¨ÙÙƒÙ Ø£ÙØ±Ù’ÙÙØ¹ÙÙ€Ù‡ÙØŒ ÙÙØ¥ÙÙ† Ø£ÙÙ…Ù’Ø³ÙÙ€ÙƒÙ’ØªÙ Ù†ÙÙÙ’Ø³Ù€ÙŠ ÙØ§Ø±Ù’Ø­ÙÙ€Ù…Ù’Ù‡Ø§ ØŒ ÙˆÙØ¥ÙÙ†Ù’ Ø£ÙØ±Ù’Ø³ÙÙ„Ù’ØªÙÙ€Ù‡Ø§ ÙØ§Ø­Ù’ÙÙØ¸Ù’Ù€Ù‡Ø§ Ø¨ÙÙ…Ù€Ø§ ØªÙØ­Ù’ÙÙÙ€Ø¸Ù Ø¨ÙÙ‡ Ø¹ÙØ¨Ù€Ø§Ø¯ÙÙƒÙ Ø§Ù„ØµÙ‘Ù€Ø§Ù„ÙØ­Ù€ÙŠÙ†.", count: 1, fadl: "Ù…Ù† Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ù…Ø£Ø«ÙˆØ±Ø©." },
                    { text: "Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ: Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù„ÙØ§ Ø¥ÙÙ„ÙÙ°Ù‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙ‘Ù Ø§Ù„Ù’Ù‚ÙÙŠÙ‘ÙÙˆÙ…Ù...", count: 1, fadl: "Ù…Ù† Ù‚Ø±Ø£Ù‡Ø§ Ø­ÙŠÙ† ÙŠØ£ÙˆÙŠ Ø¥Ù„Ù‰ ÙØ±Ø§Ø´Ù‡ØŒ ÙØ¥Ù†Ù‡ Ù„Ù† ÙŠØ²Ø§Ù„ Ø¹Ù„ÙŠÙ‡ Ù…Ù† Ø§Ù„Ù„Ù‡ Ø­Ø§ÙØ¸ØŒ ÙˆÙ„Ø§ ÙŠÙ‚Ø±Ø¨Ù‡ Ø´ÙŠØ·Ø§Ù† Ø­ØªÙ‰ ÙŠØµØ¨Ø­." }
                ]
            };

            // RENDER FUNCTIONS
            function render() {
                // Update view
                elements.viewContents.forEach(content => content.classList.add('hidden'));
                document.getElementById(`view-${state.currentView}`).classList.remove('hidden');

                // Update tabs
                elements.viewTabs.forEach(tab => {
                    tab.classList.remove('tab-active');
                    if (tab.dataset.view === state.currentView) {
                        tab.classList.add('tab-active');
                    }
                });
                
                // Update Tasbeeh UI
                elements.tasbeehText.textContent = state.tasbeehCount;
                elements.goalDisplay.textContent = state.tasbeehGoal;
                drawProgressRing();

                // Update Dark Mode
                document.documentElement.classList.toggle('dark', state.isDarkMode);
            }

            function drawProgressRing() {
                const size = 256;
                const center = size / 2;
                const radius = 110;
                const lineWidth = 20;
                ctx.clearRect(0, 0, size, size);

                const progress = state.tasbeehGoal > 0 ? state.tasbeehCount / state.tasbeehGoal : 0;
                const endAngle = (progress * 2 * Math.PI) - (0.5 * Math.PI);

                // Background track
                ctx.beginPath();
                ctx.arc(center, center, radius, 0, 2 * Math.PI);
                ctx.lineWidth = lineWidth;
                ctx.strokeStyle = state.isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                ctx.stroke();

                // Progress arc
                if (progress > 0) {
                    ctx.beginPath();
                    ctx.arc(center, center, radius, -0.5 * Math.PI, endAngle);
                    ctx.lineWidth = lineWidth;
                    ctx.strokeStyle = `var(--primary-light)`;
                    ctx.lineCap = 'round';
                    ctx.stroke();
                }
            }

            // EVENT HANDLERS
            function handleTabClick(e) {
                state.currentView = e.target.dataset.view;
                render();
            }

            function handleTasbeehClick() {
                state.tasbeehCount++;
                if (state.tasbeehCount % 33 === 0 && state.tasbeehCount !== 0) {
                    if (milestoneSynth) {
                        milestoneSynth.triggerAttackRelease("C4", "0.2");
                    }
                }
                render();
            }
            
            function handleResetClick() {
                state.tasbeehCount = 0;
                render();
            }

            function handleSetGoal() {
                elements.goalInput.value = state.tasbeehGoal;
                elements.goalModal.classList.remove('hidden');
            }

            function handleSaveGoal() {
                const newGoal = parseInt(elements.goalInput.value);
                if (newGoal > 0) {
                    state.tasbeehGoal = newGoal;
                    elements.goalModal.classList.add('hidden');
                    render();
                }
            }

            function handleCancelGoal() {
                elements.goalModal.classList.add('hidden');
            }
            
            function handleDarkModeToggle() {
                state.isDarkMode = !state.isDarkMode;
                render();
            }

            function populateDhikrAccordion() {
                elements.dhikrAccordion.innerHTML = '';
                for (const category in dhikrData) {
                    const accordionItem = document.createElement('div');
                    accordionItem.className = 'border border-gray-300 dark:border-gray-700 rounded-lg';

                    const header = document.createElement('button');
                    header.className = 'w-full text-right p-4 text-xl font-bold flex justify-between items-center';
                    header.innerHTML = `<span>${category}</span><span class="transform transition-transform duration-300">â–¼</span>`;
                    
                    const content = document.createElement('div');
                    content.className = 'accordion-content px-4 pb-2';

                    dhikrData[category].forEach(dhikr => {
                        const card = document.createElement('div');
                        // Changed background for better contrast
                        card.className = 'p-3 mb-2 rounded-md bg-gray-50 dark:bg-gray-900 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800';
                        card.textContent = dhikr.text.substring(0, 50) + '...';
                        card.onclick = () => showDhikrDetails(dhikr);
                        content.appendChild(card);
                    });

                    header.onclick = () => {
                        const icon = header.querySelector('span:last-child');
                        if (content.style.maxHeight) {
                            content.style.maxHeight = null;
                            icon.style.transform = 'rotate(0deg)';
                        } else {
                            document.querySelectorAll('.accordion-content').forEach(el => el.style.maxHeight = null);
                            document.querySelectorAll('.accordion-content ~ button span:last-child').forEach(el => el.style.transform = 'rotate(0deg)');
                            content.style.maxHeight = content.scrollHeight + "px";
                            icon.style.transform = 'rotate(180deg)';
                        }
                    };
                    
                    accordionItem.appendChild(header);
                    accordionItem.appendChild(content);
                    elements.dhikrAccordion.appendChild(accordionItem);
                }
            }
            
            function showDhikrDetails(dhikr) {
                elements.dhikrModalContent.innerHTML = `
                    <p class="text-2xl leading-relaxed font-semibold">${dhikr.text}</p>
                    <div class="flex items-center justify-between text-lg pt-4 border-t border-gray-300 dark:border-gray-600">
                        <span>Ø§Ù„ØªÙƒØ±Ø§Ø±: <span class="font-bold text-accent">${dhikr.count}</span></span>
                        <button class="play-audio-btn p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700" title="ØªØ´ØºÙŠÙ„ ØµÙˆØª">ğŸ”Š</button>
                    </div>
                    <div>
                        <h4 class="font-bold text-lg mt-2">Ø§Ù„ÙØ¶Ù„:</h4>
                        <p class="opacity-80">${dhikr.fadl}</p>
                    </div>
                `;
                elements.dhikrModal.classList.remove('hidden');
                
                elements.dhikrModalContent.querySelector('.play-audio-btn').onclick = () => {
                    if (synth) {
                        synth.triggerAttackRelease("C4", "0.5");
                    }
                };
            }
            
            function closeDhikrModal() {
                 elements.dhikrModal.classList.add('hidden');
            }
            
            // VOICE RECOGNITION
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            let recognition;

            if (SpeechRecognition) {
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.lang = 'ar-SA';
                recognition.interimResults = false;

                recognition.onresult = (event) => {
                    const transcript = event.results[event.results.length - 1][0].transcript.trim();
                    const selectedTasbeeh = elements.tasbeehSelect.value;
                    if (transcript.includes(selectedTasbeeh.split(' ')[0])) { // Check for first word
                        handleTasbeehClick();
                    }
                };
                
                recognition.onstart = () => {
                    state.isListening = true;
                    elements.voiceStatus.textContent = "Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠ ÙŠØ¹Ù…Ù„...";
                    elements.voiceStatus.classList.remove('opacity-0');
                    elements.voiceControlBtn.classList.add('ring-2', 'ring-red-500');
                };

                recognition.onend = () => {
                    state.isListening = false;
                    elements.voiceStatus.classList.add('opacity-0');
                    elements.voiceControlBtn.classList.remove('ring-2', 'ring-red-500');
                };
                
                recognition.onerror = (event) => {
                     elements.voiceStatus.textContent = `Ø®Ø·Ø£: ${event.error}`;
                };
                
            }

            function toggleVoiceControl() {
                if (!SpeechRecognition) {
                    alert("Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØµÙˆØªÙŠ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­.");
                    return;
                }
                if (state.isListening) {
                    recognition.stop();
                } else {
                    recognition.start();
                }
            }

            // INITIALIZATION
            elements.viewTabs.forEach(tab => tab.addEventListener('click', handleTabClick));
            elements.tasbeehBtn.addEventListener('click', handleTasbeehClick);
            elements.resetBtn.addEventListener('click', handleResetClick);
            elements.setGoalBtn.addEventListener('click', handleSetGoal);
            elements.saveGoalBtn.addEventListener('click', handleSaveGoal);
            elements.cancelGoalBtn.addEventListener('click', handleCancelGoal);
            elements.darkModeToggle.addEventListener('click', handleDarkModeToggle);
            elements.closeDhikrModalBtn.addEventListener('click', closeDhikrModal);
            elements.voiceControlBtn.addEventListener('click', toggleVoiceControl);
            
            populateDhikrAccordion();
            render();
        });
  </script>
</body>
</html>
